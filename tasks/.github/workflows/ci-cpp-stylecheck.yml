name: C++ Style Check

on:
  push:
    branches: [main, hw]
    paths:
      - 'tasks/**/*.c'
      - 'tasks/**/*.cpp'
      - 'tasks/**/*.h'
      - 'tasks/**/*.hpp'
  pull_request:
    branches: [main, hw]
    paths:
      - 'tasks/**/*.c'
      - 'tasks/**/*.cpp'
      - 'tasks/**/*.h'
      - 'tasks/**/*.hpp'

jobs:
  style-check:
    name: Check Code Style
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Install clang-format
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-format
    
    - name: Check code formatting
      run: |
        echo "Checking code formatting with clang-format..."
        
        # Проверяем все файлы и собираем ошибки
        has_errors=0
        
        while IFS= read -r file; do
          echo "Checking: $file"
          if ! clang-format --dry-run --Werror "$file" 2>&1; then
            echo "❌ Style issues in: $file"
            has_errors=1
          fi
        done < <(find tasks -type f \( -iname '*.c' -o -iname '*.cpp' -o -iname '*.h' -o -iname '*.hpp' \))
        
        if [ $has_errors -eq 1 ]; then
          echo ""
          echo "❌ Code style check failed! Please run clang-format on the files above."
          exit 1
        fi
        
        echo ""
        echo "✅ All files are properly formatted"